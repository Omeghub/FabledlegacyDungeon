return function(AutoFarmRef, AutoSpellRef)
    local Players = game:GetService("Players")
    local RunService = game:GetService("RunService")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local Workspace = game:GetService("Workspace")
    local LocalPlayer = Players.LocalPlayer
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

    local ATTACK_MIN_DISTANCE = 1
    local ATTACK_MAX_DISTANCE = 25
    local MOVE_MIN_DISTANCE = 1
    local BACK_STEP = 4
    local MOVE_REFRESH = 0.25
    local CHECKPOINT_REACH = 6
    local NEARBY_MOB_RADIUS = 150
    local AttackDelay = 1
    local SpellDelay = 0.05

local checkpoints = {
    Vector3.new(-1232.990, 73.014, -350.831),
    Vector3.new(-978.579, 69.736, -348.977),
    Vector3.new(-799.713, 69.444, -412.609),
    Vector3.new(-711.830, 74.347, -482.527),
    Vector3.new(-520.701, -85.292, -587.851),
    Vector3.new(-474.031, -85.321, -700.067),
    Vector3.new(-610.082, -53.655, -992.448),
    Vector3.new(-673.337, -49.478, -1121.110),
    Vector3.new(-660.011, -49.906, -1203.913),
    Vector3.new(-616.850, -59.319, -1441.146),
    Vector3.new(-618.274, -97.200, -1544.936),
    Vector3.new(-623.651, -97.092, -1638.400),
    Vector3.new(-634.332, -80.281, -1730.566)
}


    local ActiveCheckpoints = {}
    for _, cp in ipairs(checkpoints) do table.insert(ActiveCheckpoints, cp) end

    local Character, HRP, Humanoid
    local LastMoveTime = 0
    local LastSwingTime = 0
    local GameCompleted = false

    local function GetRoot(model)
        if model.PrimaryPart then return model.PrimaryPart end
        for _, v in ipairs(model:GetDescendants()) do
            if v:IsA("BasePart") then return v end
        end
        return nil
    end

    local function IsMobAlive(name)
        local enemies = Workspace:FindFirstChild("Enemies")
        if not enemies then return false end
        local mob = enemies:FindFirstChild(name)
        if mob and mob.Parent then
            local hum = mob:FindFirstChildOfClass("Humanoid")
            return hum and hum.Health > 0
        end
        return false
    end

    local function GetBestTarget()
        local enemies = Workspace:FindFirstChild("Enemies")
        if not enemies then return nil end
        if IsMobAlive("Beastmaster Joe & Abbadon") then
            return GetRoot(enemies["Beastmaster Joe & Abbadon"])
        end
        if IsMobAlive("The Beast King") then
            return GetRoot(enemies["The Beast King"])
        end
        local closest, dist = nil, math.huge
        for _, mob in ipairs(enemies:GetChildren()) do
            if mob:IsA("Model") then
                local hum = mob:FindFirstChildOfClass("Humanoid")
                local root = GetRoot(mob)
                if hum and root and hum.Health > 0 then
                    local d = (root.Position - HRP.Position).Magnitude
                    if d < dist and d <= NEARBY_MOB_RADIUS then
                        dist = d
                        closest = root
                    end
                end
            end
        end
        return closest
    end

    local function SetupCharacter(char)
        Character = char
        HRP = char:WaitForChild("HumanoidRootPart")
        Humanoid = char:WaitForChild("Humanoid")
        Humanoid.AutoRotate = true
    end

    if LocalPlayer.Character then SetupCharacter(LocalPlayer.Character) end
    LocalPlayer.CharacterAdded:Connect(function(char)
        task.wait(1)
        SetupCharacter(char)
    end)

    RunService.Heartbeat:Connect(function()
        if not AutoFarmRef.Value or not HRP or not Humanoid or Humanoid.Health <= 0 then return end
        if tick() - LastMoveTime < MOVE_REFRESH then return end
        LastMoveTime = tick()

        local completionScreen = PlayerGui:FindFirstChild("CompletionScreen")
        if completionScreen and completionScreen:FindFirstChild("CompletionBorder") then
            if completionScreen.CompletionBorder.Visible then
                GameCompleted = true
            end
        end
        if GameCompleted then return end

        local myPos = HRP.Position
        local target = GetBestTarget()
        local moveTarget = nil

        if target then
            local mobPos = target.Position
            local dir = (mobPos - myPos)
            local distance = dir.Magnitude
            if distance < 0.1 then distance = 0.1 end
            dir = dir.Unit

            HRP.CFrame = CFrame.lookAt(myPos, Vector3.new(mobPos.X, myPos.Y, mobPos.Z))
            if distance > ATTACK_MIN_DISTANCE then
                moveTarget = mobPos - dir * ATTACK_MIN_DISTANCE
            elseif distance < MOVE_MIN_DISTANCE then
                moveTarget = myPos - dir * BACK_STEP
            else
                moveTarget = myPos
            end

            if distance <= ATTACK_MAX_DISTANCE then
                if tick() - LastSwingTime >= AttackDelay then
                    ReplicatedStorage.Swing:FireServer()
                    LastSwingTime = tick()
                end
                if AutoSpellRef.Value then
                    for _, k in ipairs({"Q","E","R"}) do
                        local s = LocalPlayer:FindFirstChild("spell"..k)
                        local c = LocalPlayer:FindFirstChild("cooldown"..k)
                        if s and s.Value and c and c.Value <= 0 then
                            ReplicatedStorage.useSpell:FireServer(k)
                            task.wait(SpellDelay)
                        end
                    end
                end
            end
        end

        if #ActiveCheckpoints > 0 and not target then
            local cp = ActiveCheckpoints[1]
            if (cp - myPos).Magnitude <= CHECKPOINT_REACH then
                table.remove(ActiveCheckpoints, 1)
            end
            if #ActiveCheckpoints > 0 then
                moveTarget = ActiveCheckpoints[1]
            end
        end

        if moveTarget then
            local finalPos = Vector3.new(moveTarget.X, myPos.Y, moveTarget.Z)
            if (finalPos - myPos).Magnitude > 0.05 then
                Humanoid:MoveTo(finalPos)
            end
        end
    end)
end

Traduire
